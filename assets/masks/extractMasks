#!/bin/bash
# Extra the latest masks.

count=0
masksSourceFile="masks.xcf"

function name
{
    # The original numbers are generated by ImageMagick, there 0 is the bottom later, and the numbers increase in order above it.
    let count=$count-1
    newName="$1"

    mv "masks-${count}.jpg" "${newName}.jpg"
}



echo "Extracting masks. This will take a moment."
rm -f *.jpg
convert $masksSourceFile masks.jpg
count="$(ls -1 masks*jpg | wc -l)"



# Give predictable names to the masks. We just have to put the names in the same order that they appear in the $masksSourceFile .
echo "Naming the masks."
name gradient-010
name gradient-025
name gradient-050
name gradient-100
name box
name box-curves
name box-inverted
name elipse
name elipse-fromTop
name none



# Find any layers that have not been named.
echo -n "Looking for any problems. "
unhandled="$(ls -1 | grep masks.*jpg)"
if [ "$?" -eq 0 ]; then
    echo "Whoops..."
    echo "The following layers are currently unhandled:"
    echo "$unhandled"
    echo
    echo "These need to be added to $0 using the name function."
else
    echo "All good."
fi
