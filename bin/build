#!/bin/bash
# Build the site.

# Load the config.
. config

# Include the libraries.
libPath="$(dirname "$0")/lib"
. "$libPath/all.sh"

if [ "$1" == '--test' ]; then
    echo "Test mode turned on"
    touch "build/.test"
    doTest=1
fi


rm -Rf ../intermediate
mkdir -p build
generateMasks
actions src/actions/build-pre
findSubAssets | copySubAssets &
getDocs | prepDocs
sortTags
deriveLatest
fillTagCombos
getLists intermediate/tags | buildList intermediate/tags rss intermediate/feed 10
getLists intermediate/tags | buildList intermediate/tags html intermediate/list 100000
getLists intermediate/tagCombos | buildList intermediate/tagCombos html intermediate/list 100000
getLists intermediate/tags | buildRSSFeeds
find intermediate/related -type f | buildDocs
getDocs f | buildDocs
getDocs l | buildDocs
findSymlinks | copySymlinks
actions src/actions/build-post
copyAssets

# TODO Do lowercase symlinks.
