#!/bin/bash
# Upload everything to the bucket.

. config

if [ ! -f build/.test ]; then
    echo "Populating upload cache."
    rsync --checksum -rulv build/* uploadCache
    
    cd uploadCache

    aws s3 sync --delete . "$bucket"
    
    exit 0
    cd rss
    bucketNameOnly="$(echo "$bucket" | cut -b6-)"
    for feed in *; do
        aws s3api put-object --bucket "$bucketNameOnly" --key "rss/$feed" --body $feed --content-type "text/xml" --acl "public-read"
        # TODO Region assumption.
        curl -I http://${bucketNameOnly}.s3-website-eu-west-1.amazonaws.com/rss/$feed
    done
    
else
    echo "This build has been built with some form of testing enabled. Re-run freshBuild to re-enable uploads."
fi
